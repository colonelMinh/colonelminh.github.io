<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chỉnh sửa tài liệu</title>
</head>
<body>
    <h1>Chỉnh sửa tài liệu</h1>
    <textarea id="editor" rows="10" cols="100" placeholder="Nhập nội dung..."></textarea>
    <br><br>
    
    <!-- Phần chọn ID để chèn file -->
    <label for="sectionId">Chọn nơi để chèn file:</label>
    <select id="sectionId">
        <option value="high-school">Tài liệu ôn thi THPTQG</option>
        <option value="study-support">Tài liệu bổ trợ học tập</option>
        <option value="excellent-student">Tài liệu ôn thi HSG các cấp</option>
        <option value="secondary-school">Tài liệu THCS</option>
    </select>
    <br><br>

    <!-- Phần nhập tên thay thế -->
    <label for="displayName">Tên thay thế cho file:</label>
    <input type="text" id="displayName" placeholder="Ví dụ: Đề HSG số 4">
    <br><br>

    <input type="file" id="fileUploader" multiple>
    <br><br>
    <button id="saveBtn">Lưu lại</button>

    <script>
        const GITHUB_TOKEN = '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'; // Thay thế bằng GitHub Personal Access Token của bạn
        const REPO_OWNER = 'colonelMinh'; // Thay đổi thành tên người dùng GitHub của bạn
        const REPO_NAME = 'colonelminh.github.io';
        const BRANCH_NAME = 'main'; // Nhánh chính của repository

        async function uploadFileToGitHub(file, displayName, sectionId) {
            const base64Content = await toBase64(file);
            const path = `${sectionId}/${file.name}`;

            const response = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${path}`, {
                method: 'PUT',
                headers: {
                    'Authorization': `Bearer ${GITHUB_TOKEN}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: `Upload file ${file.name}`,
                    content: base64Content,
                    branch: BRANCH_NAME
                })
            });

            if (response.ok) {
                // Tạo thẻ <li> cho file trong id sectionId
                const fileLink = `<li><a href="${path}" style="color: black; text-decoration: none;">${displayName}</a></li>`;
                localStorage.setItem('file_' + sectionId + '_' + file.name, fileLink);
 // Lưu thẻ <li> vào localStorage

                alert(`File ${displayName} đã được tải lên GitHub thành công!`);
            } else {
                alert(`Lỗi khi tải lên file ${file.name}: ${response.statusText}`);
            }
        }

        function toBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = error => reject(error);
            });
        }

        document.getElementById('saveBtn').addEventListener('click', function() {
            const editorContent = document.getElementById('editor').value;
            const files = document.getElementById('fileUploader').files;
            const sectionId = document.getElementById('sectionId').value;
            const displayName = document.getElementById('displayName').value;

            if (!displayName) {
                alert('Vui lòng nhập tên thay thế cho file.');
                return;
            }

            // Gửi nội dung chỉnh sửa và file lên GitHub
            for (let i = 0; i < files.length; i++) {
                uploadFileToGitHub(files[i], displayName, sectionId);
            }

            localStorage.setItem('editorContent', editorContent);

            alert('Đã lưu lại nội dung!');
            window.location.href = 'study-document.html'; // Quay về trang tài liệu
        });
    </script>
</body>
</html>
